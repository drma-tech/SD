@inherits ComponentCore<StripeSubscriptionManager>

@using SD.Shared.Models.Subscription
@using SD.WEB.Modules.Subscription.Core
@using SD.WEB.Modules.Subscription.Resources

@inject PaymentConfigurationApi ConfigurationApi
@inject PaymentAuthApi PaymentAuthApi

<MudCard Outlined="true" Elevation="4" Class="mb-3">
    <MudCardContent Class="pa-3">
        <MudGrid Class="mb-6">
            <MudItem xs="12" sm="6">
                <MudTextField T="string" Label="@Translations.Product" Text="@Client?.GetActiveSubscription()?.Product?.GetName()" ReadOnly="true"></MudTextField>
            </MudItem>
            <MudItem xs="12" sm="6">
                <MudTextField T="string" Label="@Translations.Cycle" Text="@Client?.GetActiveSubscription()?.Cycle?.GetName()" ReadOnly="true" ShrinkLabel="true"></MudTextField>
            </MudItem>
            <MudItem xs="12" sm="6">
                <MudTextField T="string" Label="Created At" Text="@Client?.GetActiveSubscription()?.CreatedAt.DateTime.ToShortDateString()" ReadOnly="true" ShrinkLabel="true"></MudTextField>
            </MudItem>
            <MudItem xs="12" sm="6">
                <MudTextField T="string" Label="Expires Date" Text="@Client?.GetActiveSubscription()?.ExpiresDate?.DateTime.ToShortDateString()" ReadOnly="true" ShrinkLabel="true"></MudTextField>
            </MudItem>
            <MudItem xs="12" sm="6">
                <MudTextField T="string" Label="@Translations.PaymentProvider" Text="@Client?.GetActiveSubscription()?.Provider?.GetName()" ReadOnly="true"></MudTextField>
            </MudItem>
            <MudItem xs="12" sm="6">
                <MudTextField T="string" Label="@Translations.IsActive" Text="@Client?.GetActiveSubscription()?.IsActive().ToString()" ReadOnly="true" ShrinkLabel="true"></MudTextField>
            </MudItem>
        </MudGrid>
    </MudCardContent>
</MudCard>
<MudButton Color="Color.Primary" Variant="Variant.Filled" Class="me-3 mb-2" Href="@CustomerPortalUrl" Target="_blank" Rel="noindex, nofollow" Disabled="CustomerPortalUrl.Empty()">
    Change/Cancel my subscription
</MudButton>

@code {
    [Parameter][EditorRequired] public AuthPrincipal? Client { get; set; }

    private string? CustomerPortalUrl { get; set; }

    protected override async Task LoadAuthDataAsync()
    {
        CustomerPortalUrl = await PaymentAuthApi.StripePortalLink();
    }
}
