@using SD.WEB.Modules.Collections.Core
@using SD.WEB.Modules.Collections.Resources
@inherits ComponentCore<EditorsChoiceComponent>

@inject TmdbListApi TmdbListApi

<NewPageSection Title="@Translations.EditorsChoiceTitle" Description="@GlobalTranslations.CertifiedDescription" Icon="@IconsFA.Solid.Icon("award").Font">
    <BodyFragment>
        <MudTabs MinimumTabWidth="100" ApplyEffectsToContainer="true" TabPanelsClass="@Css.Build().Small("pt")"
                 ActivePanelIndex="_activeIndex" ActivePanelIndexChanged="OnTabChanged" KeepPanelsAlive="true">
            <Header>
                <MudTooltip Text="Expand">
                    <MudIconButton Icon="@IconsFA.Solid.Icon("expand").Font" Href="@($"/editors-choice/{TypeSelected}")" />
                </MudTooltip>
            </Header>
            <ChildContent>
                <MudTabPanel Text="@MediaType.movie.GetName()">
                    @if (_loaded[0])
                    {
                        <NewMediaList MediaListApi="TmdbListApi" List="@EnumLists.CertifiedStreamingDiscoveryMovies" Watched="Watched" Watching="Watching" Wish="Wish">
                        </NewMediaList>
                    }
                </MudTabPanel>
                <MudTabPanel Text="@MediaType.tv.GetName()">
                    @if (_loaded[1])
                    {
                        <NewMediaList MediaListApi="TmdbListApi" List="@EnumLists.CertifiedStreamingDiscoveryShows" Watched="Watched" Watching="Watching" Wish="Wish">
                        </NewMediaList>
                    }
                </MudTabPanel>
            </ChildContent>
        </MudTabs>
    </BodyFragment>
</NewPageSection>

@code {
    [Parameter][EditorRequired] public WatchedList? Watched { get; set; }
    [Parameter][EditorRequired] public WatchingList? Watching { get; set; }
    [Parameter][EditorRequired] public WishList? Wish { get; set; }

    private int _activeIndex = 0;
    private bool[] _loaded = new bool[2] { true, false };

    private MediaType TypeSelected => _activeIndex == 0 ? MediaType.movie : MediaType.tv;

    private void OnTabChanged(int index)
    {
        _activeIndex = index;
        _loaded[index] = true;
    }

    public Dictionary<string, string> Params { get; set; } = new() { { "mode", "compact" } };
}