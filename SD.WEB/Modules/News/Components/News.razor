@page "/news/{category}"
@using SD.Shared.Models.News
@using SD.WEB.Modules.News.Resources
@using Button = SD.WEB.Resources.Button
@inherits PageCore<News>

@inject CacheFlixsterApi CacheFlixsterApi

<SeoHeader Title="@Translations.NewsTitle" Description="@Translations.NewsDescription" Keywords="@(new[] { "News" })" Url="/news"></SeoHeader>
<NewPageSection IsPageHeader="true" Title="@Translations.NewsTitle" Description="@Translations.NewsDescription" Icon="@IconsFA.Solid.Icon("newspaper").Font"></NewPageSection>

<GoogleAdSense Section="@GoogleAdSense.AdUnit.Index"></GoogleAdSense>

<NewRenderControl Actions="Actions" Instance="NewsList" ExpressionEmpty="@((CacheDocument<NewsModel>? obj) => obj?.Data == null || obj.Data.Items.Empty())">
    <div class="grid-relative-container-news">
        @foreach (var item in NewsList?.Data?.Items ?? [])
        {
            <MudCard Style="position: relative;">
                <MudCardMedia Image="@item.url_img" Height="300" />
                <MudChip T="string" Label="true" Color="Color.Secondary" Class="poster-chip" Style="top: 8px; left: 8px; position: absolute; opacity: 0.75;" Size="AppStateStatic.Size">
                    @item.date.Humanize()
                </MudChip>
                <MudButton Color="Color.Primary" Href="@item.link" Target="_blank" Rel="noindex, nofollow"
                           Style="top: 8px; right: 8px; position: absolute; opacity: 0.75;" Variant="Variant.Filled">
                    @Button.ReadMore
                </MudButton>
                <MudCardContent Style="text-align: justify;" Class="pa-2">
                    <MudText Typo="Typo.subtitle1" Color="Color.Secondary" Align="Align.Center" Style="line-height: 1.5">@((MarkupString)item.title!)</MudText>
                    @* <div class="mt-2">
                        <MudText Typo="Typo.caption">@item.text</MudText>
                    </div> *@
                </MudCardContent>
            </MudCard>
        }
    </div>
</NewRenderControl>

<div style="position: fixed; bottom: 16px; right: 16px; display: flex; z-index: 1000;">
    <MudFab Color="Color.Secondary" StartIcon="@Icons.Material.Filled.ArrowBack" OnClick="@(() => JsRuntime.Window().HistoryBack())" Size="Size.Medium" />
</div>

@code {
    [Parameter] public required string category { get; set; }

    public ComponentActions<CacheDocument<NewsModel>?> Actions { get; set; } = new();
    private CacheDocument<NewsModel>? NewsList { get; set; }
    public string? SelectedSlide { get; set; }

    protected override async Task LoadEssentialDataAsync()
    {
        Actions.StartLoading?.Invoke(null);
        NewsList = await CacheFlixsterApi.GetNews("full", category);
        Actions.FinishLoading?.Invoke(NewsList);
    }

}
