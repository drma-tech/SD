@inherits ComponentCore<AskReview>

<MudDialog Style="width: 100%">
    <DialogContent>
        <MudText Typo="Typo.subtitle1" Color="Color.Primary" Class="mb-3" Style="text-align: center;">
            Your feedback helps us keep improving and makes it easier for new users to discover the platform.
        </MudText>

        @if (Platform != null && Platform != "webapp")
        {
            <div style="text-align: center;">
                @if (Platform == "windows")
                {
                    <MudButton Href="@_windowsReview" Target="_blank" OnClick="Reviewed" Variant="Variant.Filled">
                        <MudImage Src="/logo/microsoft-store.png" Class="me-2" Style="max-width: 20px;"></MudImage> Microsoft Store
                    </MudButton>
                }
                else if (Platform == "play")
                {
                    <MudButton Href="@_googleReview" Target="_blank" OnClick="Reviewed" Variant="Variant.Filled">
                        <MudImage Src="/logo/google-play.png" Class="me-2" Style="max-width: 20px;"></MudImage> Google Play
                    </MudButton>
                }
                else if (Platform == "ios" || Platform == "macos")
                {
                    <MudButton Href="@_appleReview" Target="_blank" OnClick="Reviewed" Variant="Variant.Filled">
                        <MudImage Src="/logo/app-store.png" Class="me-2" Style="max-width: 20px;"></MudImage> App Store
                    </MudButton>
                }
                else if (Platform == "huawei")
                {
                    <MudButton Href="@_huaweiReview" Target="_blank" OnClick="Reviewed" Variant="Variant.Filled">
                        <MudImage Src="/logo/huawei.png" Class="me-2" Style="max-width: 20px;"></MudImage> Huawei AppGallery
                    </MudButton>
                }
                else if (Platform == "xiaomi")
                {
                    <MudButton Href="@_xiaomiReview" Target="_blank" OnClick="Reviewed" Variant="Variant.Filled">
                        <MudImage Src="/logo/xiaomi.png" Class="me-2" Style="max-width: 20px;"></MudImage> Xiaomi GetApps
                    </MudButton>
                }
            </div>
        }
        else
        {
            <MudText Typo="Typo.subtitle2" Color="Color.Secondary" Class="mb-3" Style="text-align: center;">
                Choose your preferred platform to leave a review:
            </MudText>

            <MudGrid Spacing="2">
                <MudItem xs="12" md="6">
                    <MudButton Href="@_windowsStore" Target="_blank" OnClick="Reviewed" Variant="Variant.Filled" FullWidth="true">
                        <MudImage Src="/logo/microsoft-store.png" Class="me-2" Style="max-width: 20px;"></MudImage> Microsoft Store
                    </MudButton>
                </MudItem>
                <MudItem xs="12" md="6">
                    <MudButton Href="@_googleStore" Target="_blank" OnClick="Reviewed" Variant="Variant.Filled" FullWidth="true">
                        <MudImage Src="/logo/google-play.png" Class="me-2" Style="max-width: 20px;"></MudImage> Google Play
                    </MudButton>
                </MudItem>
                <MudItem xs="12" md="6">
                    <MudButton Href="@_appleStore" Target="_blank" OnClick="Reviewed" Variant="Variant.Filled" FullWidth="true">
                        <MudImage Src="/logo/app-store.png" Class="me-2" Style="max-width: 20px;"></MudImage> App Store
                    </MudButton>
                </MudItem>
                <MudItem xs="12" md="6">
                    <MudButton Href="@_huaweiStore" Target="_blank" OnClick="Reviewed" Variant="Variant.Filled" FullWidth="true">
                        <MudImage Src="/logo/huawei.png" Class="me-2" Style="max-width: 20px;"></MudImage> Huawei AppGallery
                    </MudButton>
                </MudItem>
                <MudItem xs="12" md="6">
                    <MudButton Href="@_xiaomiStore" Target="_blank" OnClick="Reviewed" Variant="Variant.Filled" FullWidth="true">
                        <MudImage Src="/logo/xiaomi.png" Class="me-2" Style="max-width: 20px;"></MudImage> Xiaomi GetApps
                    </MudButton>
                </MudItem>
            </MudGrid>
        }

    </DialogContent>
</MudDialog>

@code {
    [CascadingParameter] private IMudDialogInstance? MudDialog { get; set; }

    public string? Platform { get; set; }

    private readonly string _windowsReview = "ms-windows-store://review/?ProductId=9pb1pkrdd8l0";
    private readonly string _googleReview = "market://details?id=com.streamingdiscovery.www.twa";
    private readonly string _appleReview = "itms-apps://itunes.apple.com/app/id6749285238?action=write-review";
    private readonly string _huaweiReview = "appmarket://details?id=C111325113";
    private readonly string _xiaomiReview = "mimarket://details?id=com.streamingdiscovery.www.twa";

    private readonly string _windowsStore = "https://apps.microsoft.com/detail/9pb1pkrdd8l0";
    private readonly string _googleStore = "https://play.google.com/store/apps/details?id=com.streamingdiscovery.www.twa";
    private readonly string _appleStore = "https://apps.apple.com/us/app/streaming-discovery/id6749285238";
    private readonly string _huaweiStore = "https://appgallery.huawei.com/app/C111325113";
    private readonly string _xiaomiStore = "https://global.app.mi.com/details?lo=ID&id=com.streamingdiscovery.www.twa";

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();

        Platform = await JsRuntime.Utils().GetLocalStorage("platform");
    }

    private async Task Reviewed()
    {
        await JsRuntime.Utils().SetLocalStorage("store-reviewed", true.ToString().ToLower());
        MudDialog?.Close();
    }
}
