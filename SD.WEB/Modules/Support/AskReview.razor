@using Microsoft.AspNetCore.Components.WebAssembly.Authentication
@inherits ComponentCore<AskReview>

<MudDialog Style="width: 100%">
    <DialogContent>
        <MudText Typo="Typo.subtitle1" Color="Color.Primary" Class="mb-3">
            Your feedback helps us keep improving and makes it easier for new users to discover the platform.
        </MudText>
        @if (Platform != null && Platform != "webapp")
        {
            <ul class="ms-6 mb-3">
                <li>
                    @if (Platform == "windows")
                    {
                        <MudLink Href="@_windowsReview" Target="_blank" OnClick="() => MudDialog?.Close()" Color="Color.Tertiary">Add a review on Microsoft Store</MudLink>
                    }
                    else if (Platform == "play")
                    {
                        <MudLink Href="@_googleReview" Target="_blank" OnClick="() => MudDialog?.Close()" Color="Color.Tertiary">Add a review on Google Play</MudLink>
                    }
                    else if (Platform == "ios" || Platform == "macos")
                    {
                        <MudLink Href="@_appleReview" Target="_blank" OnClick="() => MudDialog?.Close()" Color="Color.Tertiary">Add a review on App Store</MudLink>
                    }
                    else if (Platform == "huawei")
                    {
                        <MudLink Href="@_huaweiReview" Target="_blank" OnClick="() => MudDialog?.Close()" Color="Color.Tertiary">Add a review on Huawei AppGallery</MudLink>
                    }
                    else if (Platform == "xiaomi")
                    {
                        <MudLink Href="@_xiaomiReview" Target="_blank" OnClick="() => MudDialog?.Close()" Color="Color.Tertiary">Add a review on Xiaomi GetApps</MudLink>
                    }
                </li>
            </ul>
        }
        else
        {
            <MudText Typo="Typo.subtitle2" Color="Color.Secondary" Class="mb-3">
                Choose your preferred platform to leave a review:
            </MudText>

            <ul class="ms-6 mb-3">
                <li>
                    <MudLink Href="@_windowsStore" Target="_blank" OnClick="() => MudDialog?.Close()" Color="Color.Tertiary">Add a review on Microsoft Store</MudLink>
                </li>
                <li>
                    <MudLink Href="@_googleStore" Target="_blank" OnClick="() => MudDialog?.Close()" Color="Color.Tertiary">Add a review on Google Play</MudLink>
                </li>
                <li>
                    <MudLink Href="@_appleStore" Target="_blank" OnClick="() => MudDialog?.Close()" Color="Color.Tertiary">Add a review on App Store</MudLink>
                </li>
                <li>
                    <MudLink Href="@_huaweiStore" Target="_blank" OnClick="() => MudDialog?.Close()" Color="Color.Tertiary">Add a review on Huawei AppGallery</MudLink>
                </li>
                <li>
                    <MudLink Href="@_xiaomiStore" Target="_blank" OnClick="() => MudDialog?.Close()" Color="Color.Tertiary">Add a review on Xiaomi GetApps</MudLink>
                </li>
            </ul>
        }

    </DialogContent>
</MudDialog>

@code {
    [CascadingParameter] private IMudDialogInstance? MudDialog { get; set; }

    public string? Platform { get; set; }

    private readonly string _windowsReview = "ms-windows-store://review/?ProductId=9pb1pkrdd8l0";
    private readonly string _googleReview = "market://details?id=com.streamingdiscovery.www.twa";
    private readonly string _appleReview = "itms-apps://itunes.apple.com/app/id6749285238?action=write-review";
    private readonly string _huaweiReview = "appmarket://details?id=C111325113";
    private readonly string _xiaomiReview = "mimarket://details?id=com.streamingdiscovery.www.twa";

    private readonly string _windowsStore = "https://apps.microsoft.com/detail/9pb1pkrdd8l0";
    private readonly string _googleStore = "https://play.google.com/store/apps/details?id=com.streamingdiscovery.www.twa";
    private readonly string _appleStore = "https://apps.apple.com/us/app/streaming-discovery/id6749285238";
    private readonly string _huaweiStore = "https://appgallery.huawei.com/app/C111325113";
    private readonly string _xiaomiStore = "https://global.app.mi.com/details?lo=ID&id=com.streamingdiscovery.www.twa";

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();

        Platform = await GetLocalStorage("platform");
    }
}
