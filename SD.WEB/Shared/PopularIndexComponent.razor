@using SD.WEB.Modules.Collections.Core
@using SD.WEB.Modules.Platform.Resources
@inherits ComponentCore<PopularIndexComponent>

@inject ImdbPopularApi ImdbPopularApi

<NewPageSection Title="@Translations.Popular" Description="@GlobalTranslations.PopularIndexDescription" Icon="@IconsFA.Solid.Icon("fire").Font">
    <BodyFragment>
        <MudTabs MinimumTabWidth="100" ApplyEffectsToContainer="true" TabPanelsClass="@Css.Build().Small("pt")"
                 ActivePanelIndex="_activeIndex" ActivePanelIndexChanged="OnTabChanged" KeepPanelsAlive="true">
            <Header>
                <MudTooltip Text="Expand">
                    <MudIconButton Icon="@IconsFA.Solid.Icon("expand").Font" Href="@($"/popular/{TypeSelected}")" Disabled="true" />
                </MudTooltip>
            </Header>
            <ChildContent>
                <MudTabPanel Text="@PopularType.Movie.GetName()">
                    @if (_loaded[0])
                    {
                        <NewMediaList MediaListApi="ImdbPopularApi" IsImdb="true" OnlyYear="true" StringParameters="Params" TypeSelected="MediaType.movie"
                                      Watched="WatchedList" Watching="WatchingList" Wish="WishList">
                        </NewMediaList>
                    }
                </MudTabPanel>
                <MudTabPanel Text="@PopularType.Show.GetName()">
                    @if (_loaded[1])
                    {
                        <NewMediaList MediaListApi="ImdbPopularApi" IsImdb="true" OnlyYear="true" StringParameters="Params" TypeSelected="MediaType.tv"
                                      Watched="WatchedList" Watching="WatchingList" Wish="WishList">
                        </NewMediaList>
                    }
                </MudTabPanel>
            </ChildContent>
        </MudTabs>
    </BodyFragment>
</NewPageSection>

@code {
    [Parameter][EditorRequired] public WatchedList? WatchedList { get; set; }
    [Parameter][EditorRequired] public WatchingList? WatchingList { get; set; }
    [Parameter][EditorRequired] public WishList? WishList { get; set; }

    private int _activeIndex = 0;
    private bool[] _loaded = new bool[2] { true, false };

    private PopularType TypeSelected => _activeIndex == 0 ? PopularType.Movie : PopularType.Show;

    private void OnTabChanged(int index)
    {
        _activeIndex = index;
        _loaded[index] = true;
    }

    public Dictionary<string, string> Params { get; set; } = new() { { "mode", "compact" } };
}