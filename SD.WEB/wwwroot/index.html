<!DOCTYPE html>
<html lang="en" data-bs-theme="light">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1" />
    <meta name="theme-color" content="#343a40" />

    <base href="/" />
    <link rel="manifest" href="manifest.webmanifest" />

    <link rel="stylesheet" href="css/app.min.css" />
    <link rel="stylesheet" href="css/custom_app.min.css" />
    <link rel="stylesheet" href="SD.WEB.styles.css" />
    <link rel="apple-touch-icon" sizes="512x512" href="icon-512.png" />
    <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

    <link rel="stylesheet" href="_content/Blazorise/blazorise.min.css" />
    <link rel="stylesheet" href="_content/Blazorise.Bootstrap5/blazorise.bootstrap5.min.css" />
    <link rel="stylesheet" href="_content/Blazorise.Snackbar/blazorise.snackbar.min.css" />
    <link rel="stylesheet" href="_content/Blazorise.Icons.FontAwesome/v6/css/all.min.css">

    <script defer src="https://cdn.paddle.com/paddle/v2/paddle.js"></script>
    <script defer src="js/paddle.js"></script>
    <script src="js/util.js"></script>

    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5922021468622891" crossorigin="anonymous"></script>

    <!-- Microsoft Clarity -->
    <script type="text/javascript">
        if (!window.location.host.includes('localhost')) {
            (function (c, l, a, r, i, t, y) {
                c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments) };
                t = l.createElement(r); t.async = 1; t.src = "https://www.clarity.ms/tag/" + i;
                y = l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t, y);
            })(window, document, "clarity", "script", "r2iwqdpwtv");

            // Check if Clarity is loaded and call the consent function
            var clarityCheckInterval = setInterval(function () {
                if (window.clarity) {
                    window.clarity('consent');
                    clearInterval(clarityCheckInterval);
                }
            }, 5000);
        }
    </script>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4PREF5QX1F"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        getUserInfo()
            .then(userId => {
                if (userId) {
                    gtag('config', 'G-4PREF5QX1F', {
                        'user_id': userId
                    });
                }
                else {
                    gtag('config', 'G-4PREF5QX1F');
                }
            })
            .catch(error => {
                showError(error.message);
            });
    </script>
    <script>
        const meta = document.createElement('meta');
        meta.name = 'robots';
        meta.content = window.location.hostname.includes('dev') ? 'noindex, nofollow' : "index";
        document.head.appendChild(meta);
    </script>
</head>

<body style="overflow: hidden;">
    <div id="app">
        <svg class="loading-progress">
            <circle r="40%" cx="50%" cy="50%" />
            <circle r="40%" cx="50%" cy="50%" />
        </svg>
        <div class="loading-progress-text"></div>
        <div class="loading-message" aria-live="polite"></div>
    </div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="." class="reload">Reload</a>
        <span class="dismiss">üóô</span>
    </div>

    <div id="error-container" style="position: fixed; bottom: 20px; right: 20px; max-width: 300px; background-color: rgba(220, 53, 69, 0.9); color: white; padding: 10px 15px; border-radius: 8px; display: none; font-family: sans-serif; box-shadow: 0 2px 8px rgba(0,0,0,0.2); z-index: 10000;"></div>

    <script>
        window.addEventListener('load', function () {
            const startTime = performance.now();
            const app = document.getElementById('app');
            const messageEl = document.querySelector('.loading-message');

            const checkConnection = setInterval(() => {
                const elapsed = (performance.now() - startTime) / 1000;
                const progress = parseFloat(getComputedStyle(document.documentElement)
                    .getPropertyValue('--blazor-load-percentage') || '0');

                // Clear previous classes
                app.classList.remove('slow-connection', 'very-slow-connection', 'extremely-slow-connection');

                if (elapsed > 80 && progress < 100) {
                    app.classList.add('extremely-slow-connection');
                    messageEl.textContent = "Still loading. Something may be holding things up.";
                }
                else if (elapsed > 50 && progress < 100) {
                    app.classList.add('very-slow-connection');
                    messageEl.textContent = "Still loading. This may take a little longer.";
                }
                else if (elapsed > 20 && progress < 100) {
                    app.classList.add('slow-connection');
                    messageEl.textContent = "This is taking a bit longer than expected.";
                }

                if (progress >= 100) clearInterval(checkConnection);
            }, 1000);
        });
    </script>

    <script>
        //avoid google (and others) search console execute this
        if (!/google|baidu|bingbot|duckduckbot|teoma|slurp|yandex/i.test(window.navigator.userAgent) &&
            window.navigator.serviceWorker && window.navigator.serviceWorker.register) {
            navigator.serviceWorker.register('service-worker.js');
        }
    </script>

    <script>
        const isModernBrowser = (() => {
            try {
                // Test basic required APIs
                if (typeof WebAssembly !== "object") return false;
                if (typeof WebAssembly.instantiate !== "function") return false;
                if (typeof BigInt !== "function") return false;
                if (typeof fetch !== "function") return false;
                if (typeof Promise !== "function") return false;

                // Safely test modern syntax using Function (optional chaining / nullish coalescing)
                new Function("const obj = { foo: null }; const x = obj && obj.foo !== undefined ? obj.foo : 'ok';");

                return true;
            } catch (error) {
                showError("Browser not supported: " + error.message);
                return false;
            }
        })();

        if (!isModernBrowser) {
            showBrowserWarning();
        }

        window.addEventListener('error', function (e) {
            if (e.filename && e.filename.includes('blazor.webassembly.js')) {
                showBrowserWarning();
            }
            else {
                showError(e.message);
                //todo: send log to server
            }
        });

        window.addEventListener('unhandledrejection', function (e) {
            showError(e.reason.message);
            //todo: send log to server
        });

        function showBrowserWarning() {
            document.body.innerHTML = `
                        <div style="display: flex; align-items: center; justify-content: center; min-height: 100vh; background: #f0f2f5; font-family: 'Segoe UI', Roboto, sans-serif; padding: 1rem;">
                            <div style="background: #fff; padding: 0.6rem; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); max-width: 460px; text-align: center; color: #333;">
                                <div style="font-size: 2rem; margin-bottom: 0.5rem;">‚ö†Ô∏è</div>
                                <h2 style="font-size: 1.5rem; margin-bottom: 0.5rem;">Your browser needs an update</h2>
                                <p style="font-size: 1rem; line-height: 1.6; margin-bottom: 0.5rem; text-align: justify;">
                                    This app uses modern browser features. Your current browser version isn‚Äôt compatible. Even when installed from a store, this app runs inside your device‚Äôs built-in browser.
                                </p>
                                <ul style="list-style: none; padding: 0; margin: 0; font-size: 0.95rem; color: #555; text-align: left; padding-top: 0.5rem;">
                                    <li style="margin: 0.5rem 0; text-align: center;">
                                        <img src="https://cdn.jsdelivr.net/npm/simple-icons@v11/icons/googleplay.svg" alt="Play Store" width="20" style="margin-right: 4px;" />
                                        <strong>Android</strong>: uses <strong>Chrome</strong>
                                    </li>
                                    <li style="margin: 0.5rem 0; text-align: center;">
                                        <img src="https://cdn.jsdelivr.net/npm/simple-icons@v11/icons/apple.svg" alt="App Store" width="20" style="margin-right: 4px;" />
                                        <strong>iOS/macOS</strong>: uses <strong>Safari</strong>
                                    </li>
                                    <li style="margin: 0.5rem 0; text-align: center;">
                                        <img src="https://cdn.jsdelivr.net/npm/simple-icons@v11/icons/microsoftstore.svg" alt="Microsoft Store" width="20" style="margin-right: 4px;" />
                                        <strong>Windows</strong>: uses <strong>Edge</strong>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    `;
        }
    </script>

    <script src="_content/Microsoft.Authentication.WebAssembly.Msal/AuthenticationService.js"></script>
    <script src="_framework/blazor.webassembly.js"></script>

    <script async src="_content/Toolbelt.Blazor.PWA.Updater.Service/script.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script async src="js/swiper.js"></script>

    <script>
        const appHeight = () => document.documentElement.style.setProperty('--app-height', `${window.innerHeight}px`)
        window.addEventListener('resize', appHeight)
        appHeight()
    </script>
</body>
</html>