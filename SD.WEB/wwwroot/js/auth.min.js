"use strict";async function FirebaseSignIn(n){if(typeof firebaseAuth=="undefined"||!firebaseAuth){showError("Login is temporarily unavailable. Please make sure you have a stable connection or try again later.");typeof firebase!="undefined"&&firebase?typeof firebaseAuth=="undefined"?(showError("firebaseAuth is undefined in FirebaseSignIn"),sendLog("firebaseAuth is undefined in FirebaseSignIn")):firebaseAuth||showError("The login system is still loading. Please try again."):(showError("firebase is undefined in initFirebase"),sendLog("firebase is undefined in initFirebase"));return}await firebaseAuth.signIn(n)}const firebaseConfig={apiKey:"AIzaSyDj5LpsT7-bra4hvuvb5E_BPSlD7Wr29nQ",authDomain:"auth.streamingdiscovery.com",projectId:"streaming-discovery-4c483",storageBucket:"streaming-discovery-4c483.firebasestorage.app",messagingSenderId:"394152837411",appId:"1:394152837411:web:06b7216d2859bdc1224c96",measurementId:"G-JKXTVXM0EX"},nativePlatforms=["ios","play","xiaomi"],platform=GetLocalStorage("platform");if(!isBot){firebase.initializeApp(firebaseConfig);window.auth=firebase.auth();platform==="ios"?window.auth.setPersistence(firebase.auth.Auth.Persistence.SESSION):window.auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);window.auth.onAuthStateChanged(async n=>{await AuthStateChanged(n)});if(window.auth.getRedirectResult().then(async n=>{if(navigator.userAgent.includes("webtonative")&&platform==="ios"){let t=n.user?await n.user.getIdToken():null;!t&&n.user&&(t=await n.user.getIdToken(!0));showToast(`getRedirectResult: ${t}`)}}).catch(n=>{showError(n.message),sendLog(n)}),!nativePlatforms.includes(platform)){window.messaging=firebase.messaging();window.messaging.onMessage(n=>{if(Notification.permission==="granted"){const{title:t,body:i}=n.data||{};new Notification(t,{body:i})}})}}window.firebaseAuth={signIn:async n=>{try{const r={google:new firebase.auth.GoogleAuthProvider,apple:new firebase.auth.OAuthProvider("apple.com"),facebook:new firebase.auth.FacebookAuthProvider,microsoft:new firebase.auth.OAuthProvider("microsoft.com"),yahoo:new firebase.auth.OAuthProvider("yahoo.com"),x:new firebase.auth.TwitterAuthProvider},t=r[n];if(!t)throw new Error(`Unsupported provider: ${n}`);let i=!1;isLocalhost&&(i=!0);i?await window.auth.signInWithPopup(t):await window.auth.signInWithRedirect(t)}catch(t){sendLog(t);throw new Error(t.message);}},signOut:async()=>{try{await window.auth.signOut()}catch(n){sendLog(n);throw new Error(n.message);}},getUser:()=>window.auth.currentUser};window.requestMessagingPermission=async function(){if(nativePlatforms.includes(platform)){console.log("Using native push, no web permission needed.");return}const t=await Notification.requestPermission();if(t!=="granted"){console.warn("Notifications not allowed.");return}const n=await window.messaging.getToken({vapidKey:"BJ31lWbRBbX3ZyyUHG_pQB7ZmjFtNeFjhbhuyMwUvotpXsTej5iloeSA7GdCbC7HUo314KtgMxIvXiwygAG8NhQ"});if(n)SetLocalStorage("MessagingToken",n);else{showError("Failed to register messaging token.");return}await invokeDotNetWhenReady("SD.WEB","SubscribeToTopics",{token:n,platform})};